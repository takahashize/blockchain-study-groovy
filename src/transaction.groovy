@Grapes([
        @Grab('org.bitcoinj:bitcoinj-core:0.14.3'),
        @Grab('org.slf4j:slf4j-simple:1.7.21')
])
import org.bitcoinj.core.Context
import org.bitcoinj.core.Transaction
import org.bitcoinj.core.TransactionInput
import org.bitcoinj.core.VerificationException
import org.bitcoinj.params.UnitTestParams
import org.bitcoinj.script.ScriptBuilder

import static org.bitcoinj.script.ScriptOpCodes.*

def context = new Context(UnitTestParams.get())

// The transaction in hex.
def txhex = '''\
0100000001795b88d47a74e3be0948fc9d1b4737f96097474d57151afa6f77c787961e47cc120000006a47304402202289f9e1ae2ed981cd0bf62f8\
22f6ae4aea40c65c7339d90643cea90de93ad1502205c8a08b3265f9ba7e99057d030d5b91c889a1b99f94a3a5b79d7daaada2409b6012103798b51\
f980e7a3690af6b43ce3467db75bede190385702c4d9d48c0a735ff4a9ffffffff01c0a83200000000001976a91447b8e62e008f82d95d1f565055a\
8243cc243d32388ac00000000'''.decodeHex()

def tx = new Transaction(context.getParams(), txhex)

// Confirm that the id is the reverse of the hash.
assert tx.hash.reversedBytes.encodeHex().toString() \
    == 'a96d29f25018d358ecd59eb4e5b4fe8c4c2684c5b94c7380858582357ba85ff4'
println "tx hash: ${tx.hash.reversedBytes.encodeHex()}"

// Confirm that the id is the reverse of the hash.
def txid = tx.hash.bytes.encodeHex()
assert tx.hashAsString == txid.toString()
println "tx id: $tx.hashAsString"

// Confirm that number of inputs is 1.
assert tx.inputs.size() == 1
println "tx input count: ${tx.inputs.size()}"

// Confirm that number of outputs is 1.
assert tx.outputs.size() == 1
println "tx output count: ${tx.outputs.size()}"

// Gather the input transaction hash and output number.
def prevtxhash = tx.inputs[0].outpoint.hash
def prevtxoutnum = tx.inputs[0].outpoint.index as int

// The input tx is a big one:
def prevtxhex = '010000001d3afa56e9b5b8830d4f5a4ad1dbbc97790bf5829c44b3982b8708caeacf585a7f000000006a47304402200743c47138859427e711dd02ec5cdb100a3b0148734b3bec7ad9dabed553ef7e0220516a323216288039d8e3bd3fa51a0d5610a084e8bb640d1b3c15a81e6618b25b01210239bc99235064c300ff085b71d41999d31702b0662ce04f63fc7692be4d37dbb4ffffffff71f2737f63f5a866d23fe4888a3fe5c8946ed1a7b840eb12ac628c8aa0b6ab04000000006b483045022100a96d589df8f972087c97cf679b757c5a509334c22da1dabe2f04fa3b27357d4b02206be515eeda0579229e2034a0f779989f52a5bf776d0abc870e1d3f811c9c3d49012103fe9b47333b3060bbe7c549f66fb21b72502a9f5bb24191954c70dcfb35a4bdc6ffffffff333153714dd70d2928bd86a16067b08d8c354d85fe87e8ec47d5b2f7123fbe5c030000006a473044022066194d1c50f19ee553d72ac4958dc68d00037a7abd17aee2e21423e587d5902a02207aeaf282c8710b4ebeaafb7f3a44b2415a5d433d41c34c48da84bde7603a0a13012102380ef44628fc5750abbe6387e45b3ae82db6c158e8dcac9436589e33c4831b9dffffffff2813b38b1e8ed53817d4d43323374dd5ac3018e9d8cf0292e65af1e61a4d2604000000006b48304502210097620a0b25144c9a3c43bbc79d7a899db105d09827c8e937ce6ff34277614e5c022049e7431a53382b57b62c470f009864f997515352600b8584659cb6b6ee8c40b2012102786ce6975d2ac60be7be6005d2f0b83082a4338967038117c4842a4b52f293b3ffffffff334a8f819fa6f4f3cf50a0f215f1629ccfee9e4a6fa6101f78160979b3d749c8000000006b483045022100fd32a289974cdf2d9e4522f0fd2df4cd14300b426c1670e86838a07ee54e066602203e1849b5761e6da77da7301e9cf6438496698b4c3923c49db1e681f4f4815071012103b584ae3ace7d8e70bfb34b0333aff1b6224b91867dce1bb38efb07fc7d05df6fffffffffcea6172bf9ad80aa30c39c7d7aadc0f07a0f8b94eede0b6a65a7bb6fac83904c000000006b483045022100af12c5260094aed35782b03014878386a5d1db769f7bbb22e0953174513fc03b02201f08a23fc91d011e783e212c7f0ff099787da7d9da168104adaf4198d0f759a90121028534c964f5aa118f75f09cc97bd4819314105dd3c7f589f38c55b1a2ce10d131ffffffff8607d1d95f7d5764ff640f6b3aa21e521e8c86a918d089f84e6a4b76661129e0000000006a473044022026c96850c24c88267938018867de6f2dcaee80b401f773bd9c36382353c7a91802204d4359cefccd8e13ee1dca61955d68ece0f884c8f0e8de194a70ea5a1acbe008012102dbba069a41996ff48429ce9a9ea27577acd6f0f8d18d76cb85674a1f009fcff4ffffffff741fc10f7274972e1379962456f8a9b1d710af3f1fbe15ebcba5aea9564b173c000000006b483045022100937d89a94c1ebb8b8781a5a61711308d72416223a4cfa94b89b1f100f02599fb022071b461b1b0598e07a39abcbb505659bf67e5538eabbddbabdd2b236f56a7ce33012103514eab2943608fc7bf6c388a28eec81951dbce470c7b170849fc8fe248dae51dfffffffff0303f0e2fa184481328d074d8a2b2ae0a9ade7260e1f0811d32ee720b713688020000006a4730440220572bb1a16c5ee7a72326bca2d50fd94926cab38fe58b804154e5b94d139b471c02206b4f51cd4bda13dbe406985601a7478cc4dd08aaf4a09b4821955a29024e70080121039f2f25e7f5fcb7bfb470e4a7bcbe6018d50b19ad17d69999a3392cc42b0c1239ffffffff2d8776e05770151e3141ebc881e8a971944ac9b67db8099fcb0e5019c55e112f010000006a4730440220521ed8b5f69be97738c2be07a9ef8ddb83baf4bd3f9088aa0e27f1b7dcfd312002201b8e6f117ca4abc1bca405fba9a1ac433c4f0a180e74ea12dcddbc0e11c9c3440121039a00bb224abbab8b053fde885b235cca582c8f13fc3e63fd6a23ac2d7dfda9f6ffffffffc4580f476f30beb4c310b159e039e455ccab6e62b2ca7bf360682bcc3e271787020000006b48304502210083a1d308999fda42d36d9aa629875ad8d9034cf1004b6f0bd0fd47e5f41ced700220229fbaf2b4ec453c6c801d643c4025eb0ea184b89e2b6b4051c42f0230c72850012103cca40f4137d04b69118cf7792f69f6d802ac986ec557eec8a2eb53b2317bbe26fffffffff8a80df7a58f51af1f93cb1ed02dc9ca797223caf1b7952fa53518a06ae5229b000000006a4730440220538fe29618ccf9cc1bd7696a75f4242e2f86e2dcfde415e6aa1c5b41c62f38440220321d5bf72061ba62e18b30248599f54b19333b07d48c9b28322cbf55eeea356b012103f37b20702fefc2c1f9ae9c0feb6245c1e976beadd31ec9a24399c7033dc20262ffffffffb4eb6a72f6fb15961aa6bdbd2bf440c2207d10693be6c2773f07299e54fad5f4000000006b483045022100b36782720030b387d1f3397c71632660765a0804cff63f23526524ace08c1bb40220043dd0b882b747fdd2b9a609286bef1d9c8460c8f5585676e2e96b91b5a9c78b0121034376ab5a34d94c6a07a8309bfb3f6eb72d7e2222b7ca099688ce2f8b8e222bf2ffffffff51ac17cf09d8b02f9c3906c0b5bb81a472f692daa8ffcd929e0ca746d6b16049000000006b483045022100b8b0c60d1a67a767bbd26446caa5c5464549b19b5ce0be31e6a13508d16e49b4022048ff818227c6f03545d8cd63b982dbf7be730810527e7e9a7408e3679db4c0870121034b69017d3e61ca8b7e4e262c6197ab88fdfdca944dafd97b7d70584f635bc200ffffffff2ae20821b6d93eb608ecdb0b32633ca659f1790945075a06ac36b9c35e508aad010000006b483045022100e242d630638aaeafc2319424ffc5d882b19776a3c95c17c124a18541580bae3702200ce3c3a0efe240e7bff12095d86d0f0053293d1a8aeb9d8fa2e9b8d483261c91012102ccaefbc579b15d7f73affc469d120bf5e6b93b8a500184377e837adc307492f9ffffffffd02043d511049bab7a2c9368c8a2a5f9373d05b84dc8a724286987ad12c646b0000000006b483045022100a78c0b320150b15306fdd9dc8549aa383225c3d715cb05e03327e9e4f930376402206ae2cad507d8dbcca6e63c707ebfddd72a6e22a3944ce9966e421b12a79b1b1401210280e8a57fd636ca28f8dde156ec3ec32e5f341374d200cd8bc01e020ff8be5ea3ffffffff2a80b5bb7e5ae4db97941252d3e0db7310e365945596ef5fad8329aacfa966b4000000006b483045022100cc13befc6b6fe1e40bdb7965e27d4490b5e9c7f93f00555ea7f894f0d12cea7b0220515b37c658ca60e6a1b85c0db546c3cb5156acbb0d14264086d582c96be41a2e01210391f90169c9e49a11ea9ea6e08b92876e3be3cdc89605b52bdcc84d7d8ebdceadffffffff90cb57d1eedd79e5e4d13f7b3205f5e46bd9d6eca16f214569a958d1613332d2000000006b48304502210082f36b967880a7ad866c126fc60b978ad21241392a9815cba0fa0633f8205fc902206b21c05a2c0aec652e861fe58461d67ab0604392ac1051340828eb342b1e21fb012103e145d582b47a95d7c59f2ada3ced5c60919f8354c6465b965e34ed07bca4b759ffffffff6688b2ccda79ea5a7596386562c3a351465c50fe79a5fef77117711f2b71f403000000006a473044022008ec2f5532f0e0bbc6e07915fcc46e6d70c2281462fd1df50639ab30eff188360220626ad8883a69b7d04a6a4eddb5f8d09a89bd4302433f26b89b36a94d8196f1400121029dc256ee31a099fb01aa410550e6a2f1ad98c6a4951d2613bcf6b41da7f8de94ffffffffacdba11c7bcb44b8c1ebec6078afe2cede713d8256638c391fa5df3c1973a67d050000006a47304402204aceeedd8680513262c4d5f55633e30a6afe26c143fa14ccff91fbb0d4e23ff102205d8a3d26e43199e469336f4b69fae4e814e036ad4f6918b13f976b345579f8560121032aef0db31c257213cc6acc2402fd5438a66ec86b7ac2bbf6a1036119512ad12cffffffff72bc2c4b4502944a960a70040edd0719bcc30187a20eebec86876b9e98a06f48000000006a47304402206d25dc9d4d2bbed660b4eaba25aa0599e187c9eb47e6f5419ec664d4792722e102203d19ce9d54c3f38f4ac910ffbf9855196fb19f77323cedb7edc9683f3cea9be101210253184c150781bc292a01c75abd950a5fcab974f09e8d011762d58a8924944be6ffffffffed2b95d6dddd34f7b9cf842b9032404464b4a3411013bfcaa60895a532e4628d030000006a47304402202e64c76142ed052d5d3eaa5b6fac8f4c0457035550e0a54f95189265a29d5b0d02206287392a99eecc4325e741a498deb629b388ca310504481226d4c7d6b91d29ce012103acb094fcb5c7f74f1897150aea9c01ec7bfb4f2921c7259aab3928aebc64b586ffffffffb9f740a923dcc47fca1b1a2576618f64b49e7fd269a9ade1c05ac2cdde022a45000000006b483045022100b429c78d12d72fdc94813b06c34ad11cfe542b53526a622e7835badc9b443fa0022043be8b01edc9f441d080d3de972a029f9cd0e02b9a87b66a1db6f62f3b9020790121029252afefc241077fc1773c7af793dea237d4bfe516f32911f33b6cb32ae13a23ffffffffa255be8a3e3fc402dacdddf94c33d6ae5f16c8b964b48e577daa885acc097bd4000000006a4730440220114a0ce4e18c5d5b93d6f1e402640bf61513d954467a833638ffc18096adcddd022071baa2793340c817ada79382b263acd29cfcfce03aed8e137ef3dab50f6cb392012103a456fe8d7fe65838ab7ed6223accef74b432782bffe20b106aa576f60e5d90f0ffffffffce6301cf0eb3d25ad189732c035971f6f5ba915869be16724daebd2119626e97000000006a47304402200158d9491474ddee7c1f18025a554c50206f70640da0a63a82f15efc751e44dd02203939289db27ce6ad0d82290b647cade0bf7a441ffc094e1dd2fda3aba0334f960121030ace68a21b9fc8c3e3ea129cf0dd6bd3c4eb83101b0aabaf5ae5e530afc5be08ffffffff4ad83d8400e6d36c0b182db8ea14be894bef0287b0dbe008cd35879e4938cc63030000006a473044022071bbc75479ef0439c10474881ea5a80bf02a94a2e70c7f1cd82e98d6a729f31902206ef6c3a5fdda2e573cb54e2b17d567dec7fcdfb460b8a878d1eeb50baead3d040121026594bacc7f74f93468ad72cb4cb6173e5edf113a5d35aa88124242267abad1a7ffffffffbcc39b142df36d4d57f36c743e650a05f3d472c301da03bf681c7fc2696d5bf9000000006a47304402205a793a0e781a635031803456e8609fc5633644998d9f1bd3cbffd68b8aa2a4cb0220641ea669f7cdf9ca11ef2951d6b4dba67e8bc4af74711c83f840265bcc5ca7820121038bad82bacd1f12f97b44f242ad0313ff4f68c9ce305183d07537fdeaebb2a03effffffff1a184967d62fff54805652159575580cdf858d6488115163c1a49bf5ecf2f694000000006b4830450221009c7e65ae2fc3a5c01aba7e88edeb15693399e1d90e6ac31debf5ec8dbdfefb34022017f6a1eb6e0a7acd8b02417f39d9ba1aa7b3f55ac72895ee02a53f315769b8c20121021d89abab62d6f9f0a9a52a862547f950ae2e334df89bbebbfa958b7eb6e432c2ffffffff33b36aaef117ea112c09ba9e7ecbf0a80801daaaede99d80832ebb7b85b0cf2a020000006b4830450221009b4e43f18d2bc503ca16b19fd858a1893af2fa0ed98a7e0cce86dd87befcdd97022044edf082966205d77715819a44bc13d2010bf4f2752459d0739a5f0682703026012102208600bc00e7742a6653d0d4daae3f1344f15509ce21a5331e1b373d08ed695effffffff1380789d00000000001976a914c362292db76ae67e0a9702b9d7271459570fbb5288acf0368242000000001976a914e000f96c921ff9c26c86ae8298661e3030b1eb2388acc0e42800000000001976a914cea5260b2064071f509d1059b41d38f64318b73488ac605e6e37000000001976a9147176ca151c469cb97ae7236409d5e78542b7fd3088ac70fba408000000001976a914b6dca20fb7ad79921032ae50c7714b05c7bb9d7e88ac10b16600000000001976a9144f5361efef087b144ed89ae7202550eb2019ef4488acf0062200000000001976a9146d286ba8d365f11528aa8f57c158f544698a534688ace0366e25000000001976a9144175a32ec07d4dbbb45184882cbb09d483e97b4388ac109ef416000000001976a914afd61c147cbfb9b8ff656bfbd69b2c848e5653a988ace0b89f35000000001976a91400e8bb0947ba1a951d980b1a05e3ed6ee703d52688acf0b22901000000001976a9149343c8b92ad47ff2e2147fdc439a627e57cfd84c88acf05baa22000000001976a91479844cce63e7db7336411b62be86debbb8d11fe388ac10a82900000000001976a914fae4fac2168374ab84fd0a4669d94f09c7da25d188aca0508c14000000001976a9147bb68e53e4b2f62aa354790977f835c88e81717588ac2016b000000000001976a914305232f601db886a0fedde678678ade35f31e3e988ac40597307000000001976a91411f50bf6a98c41a9e050984727f440faa3c719f888ac00c0980b000000001976a914661ef04bc427ead826566e8c1ec24ac605e2f05788ac20c8740c000000001976a9145b86768504f2d8010055b0664ec28d06fb5e319d88acd0cf3200000000001976a9141cd597793bd95c255cb4fd3f69f3b51d571ca55588ac00000000'.decodeHex()

// Confirm that we have the correct input transaction.
def prevtx = new Transaction(context.getParams(), prevtxhex)
assert prevtx.hash == prevtxhash
println "input tx id: $prevtx.hashAsString"

// We have previously gathered the scriptPubkey.
// var scriptPubkey = Script().fromString('OP_DUP OP_HASH160 20 0x1cd597793bd95c255cb4fd3f69f3b51d571ca555 OP_EQUALVERIFY OP_CHECKSIG')
def scriptPubkey = new ScriptBuilder()
        .op(OP_DUP)
        .op(OP_HASH160)
        .data("1cd597793bd95c255cb4fd3f69f3b51d571ca555".decodeHex())
        .op(OP_EQUALVERIFY)
        .op(OP_CHECKSIG)
        .build()

// Confirm that we have the correct scriptPubkey.
assert scriptPubkey.toString() == prevtx.outputs[prevtxoutnum].scriptPubKey.toString()
println "scriptPubkey: $scriptPubkey"
println "scriptSig: ${tx.inputs[0].scriptSig}"

// Run the check transaction function, which runs the script interpreter and
// also performs all the other checks to know if the transaction is valid or
// not.
tx.inputs[0].connect(prevtx, TransactionInput.ConnectMode.ABORT_ON_CONFLICT)
tx.inputs[0].verify()
println "tx is valid."

// Now suppose we modify the transaction to replace the scriptSig with
// something that is guaranteed not to be valid, such as an OP_RETURN, which
// immediately invalidates the transaction. The transaction should therefore no
// longer be valid.
def tx2 = new Transaction(context.getParams(), txhex)

tx2.inputs[0].scriptSig = new ScriptBuilder()
        .op(OP_RETURN)
        .build();

try {
    tx2.inputs[0].connect(prevtx, TransactionInput.ConnectMode.ABORT_ON_CONFLICT)
    tx2.inputs[0].verify()
    println "tx2 is valid."
} catch (VerificationException e) {
    println "modeified tx2 is not valid. $e.message"
}